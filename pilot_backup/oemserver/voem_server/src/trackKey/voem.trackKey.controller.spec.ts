import * as request from 'supertest';
import { Test, TestingModule } from '@nestjs/testing';
import { VoemVerifierInfoController } from './voem.trackKey.controller';
import { INestApplication } from '@nestjs/common';

describe('App Controller POST trackKey', () => {
  let app: INestApplication;
  let controller: VoemVerifierInfoController;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      controllers: [VoemVerifierInfoController],
    }).compile();

    controller = module.get<VoemVerifierInfoController>(VoemVerifierInfoController);

    app = module.createNestApplication();
    await app.init();
  });
  let rootCert = "3082020d308201b4a003020102020101300a06082a8648ce3d0403023052310b3009060355040613024b5231123010060355040a0c094175746f437279707431143012060355040b0c0b4d6f62696c697479526e443119301706035504030c1050494c4f542e44657669636552434132301e170d3230303732323031333235375a170d3330303732323031333235375a3052310b3009060355040613024b5231123010060355040a0c094175746f437279707431143012060355040b0c0b4d6f62696c697479526e443119301706035504030c1050494c4f542e446576696365524341323059301306072a8648ce3d020106082a8648ce3d03010703420004257046e96bbc14a1055ac99cbfae8ecb95c8672a440ba9636e524cc41f4b8e5f523244b4bc30ad810b812a4f4d957a2e3fc808c0f40cc284338cc9fde4967e4da37b3079301f0603551d230418301680144cdb48003524e6f4ddb6aa0d08c817e8a102378c301d0603551d0e041604144cdb48003524e6f4ddb6aa0d08c817e8a102378c3016060a2b0601040182c46905090101ff04053003020103300e0603551d0f0101ff040403020106300f0603551d130101ff040530030101ff300a06082a8648ce3d04030203470030440220057b8d04cf31ca5ab3751780fc68004f1b327d665a8b409abe67e0508a57174d0220513ba9393ab8d296c01bc8a94a91cf937e1dc34747957a6233f040c0f8b9ad6a";
  let instCert = "308202793082021ea003020102020102300a06082a8648ce3d0403023052310b3009060355040613024b5231123010060355040a0c094175746f437279707431143012060355040b0c0b4d6f62696c697479526e443119301706035504030c1050494c4f542e44657669636552434132301e170d3230303732323031333630365a170d3330303732323031333630365a305c310b3009060355040613024b5231123010060355040a0c094175746f437279707431143012060355040b0c0b4d6f62696c697479526e443123302106035504030c1a494e53542e4155544f2e383836413635394330454642363436333059301306072a8648ce3d020106082a8648ce3d0301070342000466cb8914f3b187759d6793a55da38f72f73248d0ca10ff94acd77df9a8eb23b90df9f7c26e3ffaed3805219be12371af682957f7f6d58f879d31af6bcd152831a381da3081d7307a0603551d230473307180144cdb48003524e6f4ddb6aa0d08c817e8a102378ca156a4543052310b3009060355040613024b5231123010060355040a0c094175746f437279707431143012060355040b0c0b4d6f62696c697479526e443119301706035504030c1050494c4f542e44657669636552434132820101301d0603551d0e041604149dc1b2a9254364d54ffcb25cc357b08c6bae9bf13016060a2b0601040182c46905080101ff04053003020103300e0603551d0f0101ff04040302010630120603551d130101ff040830060101ff020100300a06082a8648ce3d04030203490030460221009e2a0830eec833592fe7dfb5fca0fb91a2e6df3176283af30a23fbbb85bf12a7022100c866207876ab584e8fd6f1947c74c2e795e4f205f5cf79c93c5b1ae9ca195bfe";
  let digKCert = "308202a73082024da003020102020600e8d4a51011300a06082a8648ce3d040302305c310b3009060355040613024b5231123010060355040a0c094175746f437279707431143012060355040b0c0b4d6f62696c697479526e443123302106035504030c1a494e53542e4155544f2e38383641363539433045464236343633301e170d3230303732313135303030305a170d3330303732303134353935395a3020311e301c06035504030c15454e434b2e383436413634363335394330454643363059301306072a8648ce3d020106082a8648ce3d0301070342000449f02700b7dd679ff878eb51f5f7cfe077353f9ef2131e39ac94ea97a17404cc2d940db733c7807540a72edbf26969c949ee4d99a39c82e4854b3b41ea3da1e4a382013530820131307a0603551d230473307180149dc1b2a9254364d54ffcb25cc357b08c6bae9bf1a156a4543052310b3009060355040613024b5231123010060355040a0c094175746f437279707431143012060355040b0c0b4d6f62696c697479526e443119301706035504030c1050494c4f542e44657669636552434132820102301d0603551d0e04160414a1306c8cb51c40468fd4b8ab612215303a55f141300e0603551d0f0101ff04040302041030200603551d11041930178215454e434b2e3834364136343633353943304546433630540603551d1f044d304b3049a047a04586432f636e3d64705f4438726275637432546b69716d552d6a413165435a6770302c6f753d4d6f62696c697479526e442c6f3d4175746f43727970742c633d4b522e63726c300c0603551d130101ff04023000300a06082a8648ce3d0403020348003045022100979281d329ae88f17af2a980e4e0c1e0e43c94afc55743a68a19735173680d750220399daf59234c44fd550ccd891dfb9a803aff4ed4a7702058aec14f5058dd2d14";
  
  ////////////////////////////////////////////////////////////////////////////////////
  // Verifier Generate Test
  ////////////////////////////////////////////////////////////////////////////////////
  it(`verifier Generate Test will be successful`, async () => {
    return await request(app.getHttpServer())
      .get('/app/onlytest') 
      .type('json') 
      .expect(200) 
  })
  
  ////////////////////////////////////////////////////////////////////////////////////
  // Track Key TEST
  ////////////////////////////////////////////////////////////////////////////////////
  // it(`param check will be successful`, async () => {
  //   return request(await app.getHttpServer())
  //     .post('/app/trackKey')
  //     .set('x-requestId' , '80BCCEF8F59127A6D1BB5CFEB534D95')
  //     .set('x-device-oemId' , 'LG Electronics')
  //     .type('json')
  //     .send({
  //       "encryptionCertChain" : [ rootCert, instCert, digKCert ], 
  //       "encryptionVersion" : "ECIES_v1", 
  //       "keyID" : "13455143253443343542345ab",
  //       "keyType" : "OWNER",
  //       "deviceType" : "PHONE", 
  //       "accountIDHash" : "C8645830202EFEB53427A6D75F15C85E78A5195307E2351858349AB9" , 
  //       "keyData" : { 
  //         "version" : "ECIES_v1", 
  //         "ephemeralPublicKey" : "043c192b1c105685f374fd856a2ef74228af41735b404a8074cbf86e4c2b3c6b70833636ea102a8ee7614630c6a412ec40b10e3448881b46559218c5dfe6b5326b",
  //         "publicKeyHash" : "ac0095a2121357c69d64213137973222d9873bc80dbcc6ea044d6db3ec5bfbcb",
  //         "data" : "88261a31e258b9c36aeef71d64b82a5c850d47983fce6529c9d8794a8a04a7892406ad9c75bbb49413b7af0c7d0c29e97dbbcd504395e3b0357232d85662452fe90e0bbb6c899a30a5374ff65e4b9d9ddf5450fc842be827bc9c6f862ae93c7c3c0326e1845b1d3cb99f5f8a34c541320efce674570a1318041c88d68a14fecdc620401e318775ff8de35d1d67db2ba1cb9a3aa1a598a3c7a4122e40ac5088cd68ee5d1a338581106cbcdf13e9088a0ae896367886bc48c2d58547bc5b49d747d1fbfab8886863f8385c23de0f319b2f03e832ccdb4e72e13cc271bf922b19ebeec02084398bf2efa94c0cd0e28595f0a4c2406e7841baa05986bbe3d6858a28fc9a82f217b86124e68ff2dfee6eb301492c0b0776b5b96174223ce6e6d3f664235871ba13895946295fb4b7181dd7baab3fd8d163cab45d558d6dabf68dec136035368fd5592be9a61e9b21b6030ac58d04379f128c281a09ccb9027eb0dbbf085f8138964220fe25f78ce7b13d47b4f7494a352a6dd90e7171b6cadf3740286c305a32d6bfb26367ec0b60037e0d1aa1cc76364f40b3622692670c9ec7e8ee5e383872c5e946c0d2b608c74b1d0fbd48120acb84074f1cc588c74da7b721107089dc3d60ec3f8313c41d4257b33b05988dcc08b760d4cffa41c826a2bfa8ef539ede3c97c6b03889d6a098f00d6a7220bd6408af4aa259aabf30e9c574b32d113a8d380184e837ebfc0d193b9e187b56c04855da599e57e98b85d81dc407667176f912cb35d51bbf4a93408d2cccfd89588140ec63e27320a0f4bfeead36bd99d66da227f57a5b1f8f500ee8ec746bd9283c72e82b9b47d9e35669dd565b9b3054fdac3dfbebf10cc73ee8c5cbc75c75214a2f1c3c279bf07025176af2849bb41b8b4d6b65dc9ef0e63fbabaf8164cd50b7723490a006082bb447e7bc8603f89365d170d6bd2d3f50cd3dcc6b2fa67158178d9ea4a7246dcb364912d7c4548681a10b54cc0572ab5511ad3a74d2374b8ea3a74439d3811050987c46a14cc87b4dbbca178d247edfb5412d5e8b0a5cb00a433f0e90a42fd34d80955b9d8fbfd317f6ab331b0081200e1d1b103b6fb753ac8ce27a796d8e6f66694d9bdde66f6b210da310a1689ea2f79e329fd3d11a942d0cc645758e071d2fb42d40993ab7392a195279c91077bf8ad547cb6eb54eb3a168e531168be1d4dbc0c2b2fe2f342534f936606f8912531394a261621a7c877c255f0795410cc7e93dbc9b29cb08061b3e90d6d5a4684eccb60f79c1f9ac03aa02061387d902f85c8d565d85f7a0464655b617855f4d1db56bfd98f19dbb1caf7b100cce8a42360ebfc02284bb9c0bacbe5eca97aa5682cce99e92ef68e75687224450776a0543f19174b6547f0b782405311b6525e7e9e1401de7683bfaea9e9357cf6fa086becf90e6d8e97e2a1d9366a3927da8349a5b5c78b68c117a6bb647d18100219d4fd2f3b47eaeb17cf655013a3096d4100423f12f20c87240cb6d554a8f21dc850e1fa34261c21bf6e6cf58e45657a5951d051751b5f7808019642696226263b894db31fd39cf7a2fe3e688d882bb2514d51e705df6ca401045a073c7478a80a8c6e4157e9a36a22dbdd802e0aa62adce4a44e1ed872e2f0ce5ff3eb440d5eaf87ccad3acf9071c80dc3ce4c48664df8359cf363e89609dfe54670d905e97f73542519232b28e270d86d279c5e26ea11914c050d9b7cb539cca8ae3611a600e3d4cc0cff8bd9d88372ce21bcc538330426995642326b760ae7b7aada67bada784f05d4c95eb713665764b69544b387a22e4f69e7ee282cc46a67508c8d3b2cd7d2feb6cc3e2ec3967429386de94f1ae863ae01e75401c526b4bbef0eb2f3c2550bd3cba003769211538d933a9ae9e2374402947aed1caf49ead9d35f27588112097a8144a5af5204106751f1840303014bce2ab416cbfe544ba35b7812b8793bed16f2f831760bb5231a62b333722c07df1f195d2f1b2f05899a70a9ace2c357890b80fcfcce057d19845f2876b81d632c01153bad2c0e10435433a4b825d07cf5fb211f893158cd465c2fdc4510abb7a5e0c878ae1ed0db81bd2609a9078d5092b2a1568b66c27433782bbbe696cad581d8738b08de6fca2044e3cb0dd8c7b0cd47bb5ac259b1c2a60a78387689c608842b3ad4010737a7ad7f40278fcadfbd6fe05a6839d28f3945605615196ccaccfa39de437ba49091595a58ebceea7216c679df475701d8b12489ac66993ff31369c0c7803a13362a6df40f40ce051596a24b855939d5ca8ae3bd089e0fcb86ee9687cfc01ae99f1e69d4d6e69891d63c93d97a98576393bb035f1f8a7826e2639714f6c45b6df87f05565f482fb48bd0ed72db1388366874b7ee74ced1f2bfcb2b61cb00d508dc795b060e93eb858fba353a133a3e107b3d61db45b720d313763756ea76157f1124dbc814d4d91996950129e0458b2c2998d632e11297489633cceabee3158cf56eac2a28e789c1b8623980c8a0d4fc11068aabea0753d87a9ec431b76300c4592aade6003cc917493a7f841869c88f5bcaeff564347113f57661c9bd6c6904cdfc4ed59dd36dc53f3ba55dbc7ab9c70f772c2c03e82d85949d292abc7b63b52abdd7ff92c8e57634cfdbd39ee26b66ee2e296957c4b6ee542c6c203770c6f9aad209825a930af117dc50167f3eda3071a7172e20ecdeab193b27d2e54241150cf3901b0364a4d5f4e5f7757948086fa19bc8c6c42e2abb3c196ce3f5cdc9c09bce139ea7b459ae61d3de4005ddda9c890984f54c271bfb048bbbc0a84eae1ac73a4f77795c2d4403decda48513f3f3beb30a5435ae99cf805fc798f783ea51231006c0cfb6f41379c1554d50eb2bb596ab3f354e38a568b7ead0503bf4e511ed20eb32158d140b7a085b46b8eddcaf9cc136ec0e716f085dc00719a0e061d9d52e7c57f9ba5b9007f89960ebe4c93c1e0933ff7a4f6d296a790d9de33e1cf88c5576dcc00069463954d06d1558480d3332"
  //       }
  //     })
  //     .expect(200);
  // }); 

  afterAll(async () => {
    await app.close();
  });

});
